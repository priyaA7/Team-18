<!DOCTYPE html>

<html>
<head>
  <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyBElZSFIpGBAWT-dqWbjrEexWPBIsnMspQ",
      authDomain: "comp1930-9cf9c.firebaseapp.com",
      databaseURL: "https://comp1930-9cf9c.firebaseio.com",
      projectId: "comp1930-9cf9c",
      storageBucket: "comp1930-9cf9c.appspot.com",
      messagingSenderId: "222423854972"
    };
    firebase.initializeApp(config);
  </script>

  <title>Location and Destination Input</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="css/searchstyle.css">
  <link rel="stylesheet" type="text/css" href="css/dropdownstyle.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
</head>

<body id="bodyinfo">
  <div id="logo">
    <a href="search.html"><h1>PEDALS</h1></a>
  </div>

  <div id="forminput">
    <input id="searchResult2" type="text" placeholder="ENTER STARTING POSITION" name="search">
    <input id="enteredDest" type="text" placeholder="DESTINATION" name="search">
  </div> 

  <div id="map"></div>

  <div class="navbar">
    <div class="dropdown" onclick="myFunction()">
      <button class="dropbtn1"> <i class="fas fa-cocktail" style="font-size: 20px"> </i> ATTRACTIONS
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content" id="myDropdown">
        <a href="#" <font face="verdana" font size="2" color="black"> Shops </font> </a>
        <a href="#" <font face="verdana" font size="2" color="black"> Restaurants </font> </a> 
        <a href="#" <font face="verdana" font size="2" color="black"> Parks </font> </a>
      </div>
  
      <a href="https://en.wikipedia.org/wiki/Cat"> <button class="dropbtn2" onclick="myFunction2()"><i class="fas fa-road" style="font-size:24px"> </i> ROUTES 
      </button></a>
  
      <a href="https://en.wikipedia.org/wiki/Cat"> <button class="dropbtn3"> <i class="fas fa-parking" style="font-size:27px"></i> PARKING
      </button> </a>
  
      <a href="https://en.wikipedia.org/wiki/Cat"><button class="dropbtn4" > <i class="fas fa-bicycle" style="font-size:24px"></i> RENTALS
      </button></a>
  
    </div> 
  </div>
    
  <script>
    /* When the user clicks on the button, 
    toggle between hiding and showing the dropdown content */
    function myFunction() {
      document.getElementById("myDropdown").classList.toggle("show");
    }
    
    /* Close the dropdown if the user clicks outside of it */
    window.onclick = function(e) {
      if (!e.target.matches(".dropbtn1")) {
        let myDropdown = document.getElementById("myDropdown");
        if (myDropdown.classList.contains("show")) {
          myDropdown.classList.remove("show");
        }
      }
    }
  </script>

  <script>
    function initAutocomplete() {
      var map = new google.maps.Map(document.getElementById("map"), {
        center: {lat: 49.282730, lng: -123.120735},
        zoom: 10,
        mapTypeId: "roadmap"
      });

      var Destination = document.getElementById("enteredDest");
      var searchBox = new google.maps.places.SearchBox(Destination);
      
      var location = document.getElementById("searchResult2");
      var locationBox = new google.maps.places.SearchBox(location);

      // Bias the SearchBox results towards current map's viewport.
      map.addListener("bounds_changed", function() {
        searchBox.setBounds(map.getBounds());
        locationBox.setBounds(map.getBounds());
      });
      
      var markers = [];
      // Listen for the event fired when the user selects a prediction and retrieve
      // more details for that place.
      searchBox.addListener('places_changed', function() {
        let places = searchBox.getPlaces();

        if (places.length == 0) {
          return;
        }
        
        // Clear out the old markers.
        markers.forEach(function(marker) {
          marker.setMap(null);
        });
        markers = [];

        // For each place, get the icon, name and location.
        let bounds = new google.maps.LatLngBounds();
        places.forEach(function(place) {
          if (!place.geometry) {
            console.log("Returned place contains no geometry");
            return;
          }

          // Create a marker for each place.
          markers.push(new google.maps.Marker({
            map: map,
            title: place.name,
            position: place.geometry.location
          }));

          let lat = place.geometry.location.lat();
          let lng = place.geometry.location.lng();

          firebase.database().ref("Destination/").set({
            latitude: lat,
            longitude: lng
          });
          
          console.log("Longitude: ", lng);
          console.log("Latitude: ", lat);

          if (place.geometry.viewport) {
            // Only geocodes have viewport.
            bounds.union(place.geometry.viewport);
          } else {
            bounds.extend(place.geometry.location);
            }
          });
          map.fitBounds(bounds);
        });


        var markers2 = [];
        locationBox.addListener('places_changed', function() {
          let places = locationBox.getPlaces();
          if (places.length == 0) {
            return;
          }

          markers2.forEach(function(marker) {
            marker.setMap(null);
          });
          markers2 = [];

          let bounds = new google.maps.LatLngBounds();
          places.forEach(function(place) {
            if (!place.geometry) {
              console.log("Returned place contains no geometry");
              return;
            }

            markers2.push(new google.maps.Marker({
              map: map,
              title: place.name,
              position: place.geometry.location
            }));

            let lat = place.geometry.location.lat();
            let lng = place.geometry.location.lng();

            firebase.database().ref("Starting/").set({
              latitude: lat,
              longitude: lng
            });

            if (place.geometry.viewport) {
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
        });
        map.fitBounds(bounds);
      });
    }
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWkAVDBqCAsTxYkIoZI9FtxMbyo6n9Ezs&libraries=places&callback=initAutocomplete"
  async defer></script>
</body>
</html>